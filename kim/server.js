var express=require("express"),app=express();require("./router/main")(app),app.set("views",__dirname+"/views"),app.set("view engine","ejs"),app.engine("html",require("ejs").renderFile);var server=app.listen(3e3,function(){console.log("Server started on port 3000!")}),crypt=require("./db_module/algorithm"),moment=require("moment"),_=require("lodash"),io=require("socket.io")(server),db=require("./db_module/db"),fs=require("fs"),nodemailer=require("nodemailer"),Modules={select:require("./app_modules/select"),update:require("./app_modules/update"),insert:require("./app_modules/insert"),auth:require("./app_modules/auth"),pages:require("./app_modules/pages"),files:require("./app_modules/files")};allConnections=[];var getSocketId=function(a){var b=null,c=_.forEach(allConnections,function(c,d){return c.token==a?(b=c.socketid,!1):void 0});return c[0].socketid};io.on("connection",function(a){var b=function(b){void 0!==b.token&&b.token.length>5&&(_.forEach(allConnections,function(a,c){void 0!=a&&a.token==b.token&&allConnections.splice(c,1)}),allConnections.push({token:b.token,socketid:a.id}))};a.on("server",function(c){b(c),Modules[c.module].Module({request:c.request,respondTo:c.respondTo,params:c.params,io:io,socketid:a.id,db:db,crypt:crypt,app:app,token:c.token,fs:fs,moment:moment,getSocketId:getSocketId,nodemailer:nodemailer})})});